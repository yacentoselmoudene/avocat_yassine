{# FILE: templates/affaires/detail.html #}
{% extends 'generic/detail.html' %}
{% block title %}تفاصيل القضية{% endblock %}
{% block page_title %}تفاصيل القضية{% endblock %}

{% block header_actions %}
  <div class="btn-group me-2" role="group">
    <a href="?view=table" class="btn btn-outline-secondary">جدول</a>
    <a href="?view=cards" class="btn btn-outline-secondary">بطاقات</a>
  </div>

  <!-- تعديل القضية (يفتح نموذج التعديل) -->
  <a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#mainModal"
     hx-get="{% url 'cabinet:affaire_update' object.pk %}" hx-target="#modalBody">
    <i class="bi bi-pencil ms-1"></i> تعديل
  </a>

  <!-- + جلسة -->
  <a href="#" class="btn btn-warning {% if lock_postdecision %}disabled pe-none opacity-50{% endif %}" data-bs-toggle="modal" data-bs-target="#mainModal"
     hx-get="{% url 'cabinet:audience_create' object.pk %}" hx-target="#modalBody">
    <i class="bi bi-calendar-plus ms-1"></i> جلسة
  </a>

  <!-- + إجراء -->
  <a href="#" class="btn btn-outline-primary {% if lock_postdecision %}disabled pe-none opacity-50{% endif %}" data-bs-toggle="modal" data-bs-target="#mainModal"
     hx-get="{% url 'cabinet:mesure_create' object.pk %}" hx-target="#modalBody">
    <i class="bi bi-list-check ms-1"></i> إجراء
  </a>

  <!-- + خبرة -->
  <a href="#" class="btn btn-outline-dark {% if lock_postdecision %}disabled pe-none opacity-50{% endif %}" data-bs-toggle="modal" data-bs-target="#mainModal"
     hx-get="{% url 'cabinet:expertise_create' object.pk %}" hx-target="#modalBody">
    <i class="bi bi-eyeglasses ms-1"></i> خبرة
  </a>

  <!-- + حكم -->
  <a href="#" class="btn btn-outline-secondary {% if lock_postdecision %}disabled pe-none opacity-50{% endif %}" data-bs-toggle="modal" data-bs-target="#mainModal"
     hx-get="{% url 'cabinet:decision_create' object.pk %}" hx-target="#modalBody">
    <i class="bi bi-hammer ms-1"></i> حكم
  </a>

  <!-- + تبليغ -->
  <a href="#" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#mainModal"
     hx-get="{% url 'cabinet:notification_create' object.pk %}" hx-target="#modalBody">
    <i class="bi bi-envelope-paper ms-1"></i> تبليغ
  </a>

  <!-- + طعن -->
  <a href="#" class="btn btn-outline-success {% if lock_predecision %}disabled pe-none opacity-50{% endif %}" data-bs-toggle="modal" data-bs-target="#mainModal"
     hx-get="{% url 'cabinet:voiederecours_create' object.pk %}" hx-target="#modalBody">
    <i class="bi bi-arrow-90deg-left ms-1"></i> طعن
  </a>

  <!-- + تنفيذ -->
  <a href="#" class="btn btn-outline-success {% if lock_predecision %}disabled pe-none opacity-50{% endif %}" data-bs-toggle="modal" data-bs-target="#mainModal"
     hx-get="{% url 'cabinet:execution_create' object.pk %}" hx-target="#modalBody">
    <i class="bi bi-gear ms-1"></i> تنفيذ
  </a>
{% endblock %}

{% block detail_body %}
  <dl class="row">
    <dt class="col-sm-3">المرجع</dt><dd class="col-sm-9">{{ object.reference_interne }}</dd>
    <dt class="col-sm-3">نوع القضية</dt><dd class="col-sm-9">{{ object.get_type_affaire_display }}</dd>
    <dt class="col-sm-3">الحالة</dt><dd class="col-sm-9">{{ object.get_statut_affaire_display }}</dd>
    <dt class="col-sm-3">المحكمة</dt><dd class="col-sm-9">{{ object.juridiction }}</dd>
    <dt class="col-sm-3">تاريخ الفتح</dt><dd class="col-sm-9">{{ object.date_ouverture }}</dd>
  </dl>
  <div
  hx-get="{% url 'cabinet:affaire_timeline' object.pk %}"
  hx-trigger="load"
  hx-target="this"
  hx-swap="outerHTML">
  <!-- placeholder pendant le chargement -->
  <div class="text-center text-secondary py-3">جاري تحميل الجدول الزمني…</div>
</div>
{% endblock %}

{% block detail_actions %}
  <!-- زر إضافة خطوة سريعة (جلسة كافتراض) -->
  <button class="btn btn-success w-100" data-bs-toggle="modal" data-bs-target="#mainModal"
          hx-get="{% url 'cabinet:audience_create' object.pk %}" hx-target="#modalBody">
    <i class="bi bi-plus-circle ms-1"></i> إضافة خطوة سريعة
  </button>

  <button class="btn btn-outline-primary w-100 mt-2" data-bs-toggle="modal" data-bs-target="#mainModal"
          hx-get="{% url 'cabinet:affaire_update' object.pk %}" hx-target="#modalBody">
    <i class="bi bi-pencil ms-1"></i> تعديل القضية
  </button>

  <button class="btn btn-outline-danger w-100 mt-2" data-bs-toggle="modal" data-bs-target="#mainModal"
          hx-get="{% url 'cabinet:affaire_delete' object.pk %}" hx-target="#modalBody">
    <i class="bi bi-trash ms-1"></i> حذف
  </button>
{% endblock %}
